package net.skinner.scraper;

import java.io.IOException;

import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

public class ScheduleScraper {
	public static void main(String[] args) {
		ScheduleScraper.run();
	}
	
	private static void run() {
		String baseURL = "http://www.mlssoccer.com/schedule";
		for (int month = 3; month <= 12; month++) {
			Connection conn = Jsoup.connect(baseURL + "?month=" + month);
			
			Document scheduleDoc = null;
			int retries = 0;
			while(scheduleDoc == null){
				try {
					scheduleDoc = conn.get();
				} catch (IOException e) {
					if(retries >= 10){
						e.printStackTrace();
						return;
					}
					System.out.println("Failed to get document, trying again");
					retries++;
				}
			}
			
			Elements scheduleSection = scheduleDoc.select("div.schedule-page");
			Elements dates = scheduleSection.select("h3");
			Elements scheduleTables = scheduleSection.select("table");
			
			for (int i = 0; i < scheduleTables.size(); i++) {
				Elements gameRows = scheduleTables.get(i).select("tbody").select("tr");
				System.out.println(gameRows.get(0));
			}
				
		}
	}
}
